{% import "_includes/forms" as forms %}

{% includeCssResource 'supertable/css/SuperTableConfigurator.css' %}

{% set blockTypeInput %}
	<table id="{{ id }}" class="shadow-box editable">
		<thead>
			<tr>
				<th scope="col" class="header">{{ 'Column Heading'|t }}</th>
				<th scope="col" class="header">{{ 'Handle'|t }}</th>
				<th scope="col" class="header">{{ 'Width'|t }}</th>
				<th scope="col" class="header">{{ 'Type'|t }}</th>
				<th class="header" colspan="3"></th>
			</tr>
		</thead>
		<tbody>
			{% for blockType in settings.getBlockTypes() %}
				{% for field in blockType.getFields() %}
					{% set fieldId = field.id %}
					{% set fieldType = field.getFieldType() %}
					{% set fieldName = 'blockTypes['~blockType.id~'][fields]['~fieldId~']' %}

					{# Additional field settings #}
					{% if settings.columns is defined %}
						{% set width = (settings.columns[fieldId] is defined) ? settings.columns[fieldId].width : '' %}
					{% endif %}

					<tr data-id="{{ fieldId }}" data-blockType="{{ blockType.id }}">
						<td class="textual">
							<textarea name="{{ fieldName }}[name]" rows="1">{{ field.name }}</textarea>
						</td>

						<td class="textual code">
							<textarea name="{{ fieldName }}[handle]" rows="1">{{ field.handle }}</textarea>
						</td>

						<td class="textual code" width="50">
							<textarea name="{{ fieldName }}[width]" rows="1">{{ width is defined ? width : '' }}</textarea>
						</td>

						<td class="thin">
							{% include "_includes/forms/select" with {
								class: 'small',
								id: fieldId~'-type',
								name: fieldName~'[type]',
								options: fieldTypes,
								value: fieldType.getClassHandle(),
							} only %}
						</td>

						<td class="settings-col hidden">
							<div class="fieldtype-settings" name="{{ fieldName }}[typesettings]">
								<div>
									{% namespace fieldName~'[typesettings]' %}
										{{ fieldType.getSettingsHtml()|raw  }}
									{% endnamespace %}
								</div>
							</div>
						</td>

						<td class="thin action"><a class="settings icon" title="{{ 'Settings' | t }}"></a></td>
						<td class="thin action"><a class="move icon" title="{{ 'Reorder'|t }}"></a></td>
						<td class="thin action"><a class="delete icon" title="{{ 'Delete'|t }}"></a></td>
					</tr>
				{% endfor %}
			{% endfor %}
		</tbody>
	</table>

	<div class="btn add icon">{{ "Add a column"|t }}</div>

{% endset %}

{{ forms.selectField({
	label: "Field Layout"|t,
	instructions: "Set how you want your fields to appear when editing. Table Layout displays fields vertically, while Row Layout displays fields horizontally."|t,
	id: 'fieldLayout',
	name: 'fieldLayout',
	options: {table: 'Table Layout', row: "Row Layout"},
	value: settings.fieldLayout,
}) }}

<div class="supertable-configurator">
	{{ forms.field({
		label: "Configuration"|t,
		instructions: "Define the columns your Super Table should have."|t,
		name: 'config'
	}, blockTypeInput) }}
</div>
